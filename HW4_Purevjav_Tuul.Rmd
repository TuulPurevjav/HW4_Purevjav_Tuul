---
title: "HW4 Table"
author: "Tuul Purevjav"
date: "3/7/2022"
output: html_document
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
---

```{r}
library(tidyverse)
library(knitr)
library(kableExtra)
library(reactable)
```

We're planning to move to Washington state this summer.  The approximate area we'd like to move to is in King county.  We have two school-age kids and choosing a school for them is our starting point. For this assignment, I created a directory table for K-12 public schools in King County, Washington. 
Data source is at https://geo.wa.gov/datasets/k12wa::washington-state-public-schools/about .


```{r}
districts <- read_csv("Washington_School_Districts.csv", show_col_types = FALSE)
districts <- districts %>% 
  filter(County == "King") %>% 
  select(LEACode, Website) %>% 
  drop_na()

# get school data on King county
schools <- read_csv("Washington_State_Public_Schools.csv", show_col_types = FALSE)
schools <- schools %>%
  filter(County == "King") %>%
  select(Latitude,Longitude,SchoolCode, SchoolName, GradeCategory, LowestGrade, HighestGrade, PhysicalAddress, Email, Phone, LEACode, LEAName) %>%
  drop_na()
```

```{r}
# left join using merge() to merge school and district
df.school.district <- merge(x=schools, y=districts, by="LEACode", all.x=TRUE)
```

```{r}
# put address and SchoolCode into one df
df.school.address <- paste0(schools$SchoolCode, ",", schools$PhysicalAddress)

# remove whit space
df.school.address <- str_replace_all(df.school.address, fixed(" "), "")
dat = data.frame(Addresses = df.school.address, stringsAsFactors = FALSE)

# parse address string into street, city and zip code
dat2 = sapply(dat$Addresses, strsplit, ",")
dat2 = data.frame(matrix(unlist(dat2), ncol = 5, byrow = TRUE), stringsAsFactors = FALSE)
dat2$Zip5 = sapply(dat2$X5, function(x) strsplit(x, "-")[[1]][1])
dat2$Zip4 = sapply(dat2$X5, function(x) strsplit(x, "-")[[1]][2])
dat2 = dat2[,-5]
dat2 = dat2[,-6]
colnames(dat2) = c("SchoolCode", "Street", "City", "State", "Zip")
dat2[, 1] <- sapply(dat2[, 1], as.numeric)
```

```{r}
# add parsed address to school
schools <- merge(x=df.school.district, y=dat2, by = "SchoolCode", all.x=TRUE)
# remove white space from City column
schools$City <- str_replace_all(schools$City, fixed(" "), "")
```

My first choice for displaying the table was to use `DT` library, but I wasn't able to figure out the knitting issue.  So, I used `reactable` library instead. It still provides nice functionalities of page scrolling and column sorting.
```{r}
tbl_school <- schools  %>%
  select(City, Zip, SchoolName, GradeCategory, LowestGrade, HighestGrade, PhysicalAddress, Phone, LEAName) %>%
  reactable(columns = list(
    City = colDef(name = "City"),
    Zip = colDef(name = "Zip Code"),
    GradeCategory = colDef(name = "Grade Category"),
    SchoolName = colDef(name = "Name"),
    GradeCategory = colDef(name = "Grade Category"),
    LowestGrade = colDef(name = "Lowest Grade"),
    HighestGrade = colDef(name = "Highest Grade"),
    PhysicalAddress = colDef(name = "Address"),
    Phone = colDef(name = "Phone"),
    LEAName = colDef(name = "District")
  ))
tbl_school
```


